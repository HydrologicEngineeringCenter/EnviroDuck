
C     / the following allows for screen manipulation as in color changes.
C     / utilizing microsoft fortran commands.(ADVANCED TOPICS)
C     / it utilizes setbkcolor, settextcolor, setvideoconfig, outtext
C
C     THIS PROGRAM WAS DEVELOPED TO SHOW THE HABITAT SITUATION OF VARIOUS
C     AREAS, BY GIVING THE AVERAGE ACRES.
C
C     TO EXECUTE THE PROGRAM ENTER THE FOLLOWING:
C
C     ENV-DUC1 D=<DATABASE NAME> I=<INPUT FILE NAME> O=<OUTPUT FILE NAME>
C             OPTION=<1 OR 2>
C     OPTION 1 IS WHERE ALL THE OUTPUT IS PRINTED - AS IN THE DAILY VALUES.
C     OPTION 2 IS WHERE JUST THE AVERAGES & TOTALS ARE PRINTED.(NO DAILY
C            VALUES)
C
C     EXAMPLE INPUT FILE:(BEGINNING IN COLUMN 1)
C     01MAR 31JUN             *BEGINNING & ENDING DATE OF SEASONED ANALYSIS.
C     120  1.5 34             *DAYS OF DURATION FOR WATERFOWL HABITAT (120),
C                              MAX WATER DEPTH, DAYS TO EXHAUSTION OF FOOD.
C     1963 1992               *BEGINNING & ENDING YEAR OF SEASONED ANALYSIS.
C     /A/B/C//E/F/            *PATHNAME FOR STAGE DATA.
C     /A/B/C//E/F/            *PATHNAME FOR ACRE DATA.
C
C    Important Note in Reference to the Months(Line 1):
C
C
C     Format for the Input file:
C
C     A5,1X,A5
C     I3,1X,F4.1,1X,I3    - 009 99.9 OR BB9 99.9 (Where B is a Blank Space)
C     A4,1X,A4
C     A80
C     A80
C
C
      REAL IFLTAB(20000), IFFTAB(20000), STAGES(20000), ACRES(20000),
     .     XACRES(400), CDEPTH(400), DEPTH(400), AVG1, AVG2, AVG3, AVG4,
     .     WTRDEPTH, WFTEST, SUBTRAC, STORE(20000), TOTALWF,
     .     WFACRE, DEEPACRE, DURACRE, FACRES, YEARACRE,
     .     TAVG1, TAVG2, TAVG3, TAVG4, TAVG5, AVG5
C
      INTEGER*4 JULS, JULE, IOFSET, JUL1, JUL2, JUL, INTL
C
      INTEGER ISTAT, DURATION, NOYEARS, DUR(20000), NVALS, NDATE,
     .        PATHNO, NO, DURCNT, NUMBER, NUM1, NUM2, NODAYS, NM,
     .        NA, NB, NC, ND, NE, NF, ORCNT, GRORCNT, RCHTOTAL,
     .        ACCT1, ACCT2, INCT, ACCT3, DURDIFF, JULDAYS,DTE,
     .        DE(20000)
C
      CHARACTER DSSHYD*40, INPUT*40, BEGDATE*5, ENDDATE*5, BEGYEAR*4,
     .          ENDYEAR*4, STAGPATH(20000)*80, CPATH*80, CHECK*1,
     .          CDATE*9, CTIME*8, CUNITS*8, CTYPE*8, OUTPUT*40,
     .          ACREPATH(20000)*80, DATE1*9, DATE2*9, BYEAR*4,
     .          CA*32, CB*32, CC*32, CD*32, CE*32, CF*32, OYEAR*4,
     .          DATE3*9, DATE4*9, PDATE*9, OPTION*1, FLAG*1
C
      CALL ATTACH(0,'DSSHYD',' ','NOP',DSSHYD,ISTAT)
      CALL ATTACH(0,'INPUT',' ','NOP',INPUT,ISTAT)
      CALL ATTACH(0,'OUTPUT',' ','NOP',OUTPUT,ISTAT)
      CALL ATTACH(0,'OPTION',' ','NOP',OPTION,ISTAT)
      CALL ATTEND
C
      OPEN(2,FILE=INPUT,ACCESS='SEQUENTIAL',STATUS='UNKNOWN')
      OPEN(4,FILE=OUTPUT,ACCESS='SEQUENTIAL',STATUS='UNKNOWN')
      OPEN(8,FILE='SCRATCH',ACCESS='SEQUENTIAL',STATUS='UNKNOWN')
      CALL ZOPEN(IFLTAB,DSSHYD,ISTAT)
      CALL ZOPEN(IFFTAB,DSSHYD,ISTAT)
C
      READ(2,10,END=900)BEGDATE,ENDDATE
       READ(2,11,END=900)DURATION,WTRDEPTH,DTE
        READ(2,12,END=900)BEGYEAR,ENDYEAR
C
         CALL DATJUL(BEGDATE,JULS,ISTAT)
          CALL DATJUL(ENDDATE,JULE,ISTAT)
           NUM1=INTGR(BEGYEAR,1,4,IERR)
           NUM2=INTGR(ENDYEAR,1,4,IERR)
           NOYEARS=NUM2-NUM1+1
           NM=NOYEARS
            DATE1=BEGDATE//BEGYEAR
            DATE2='31DEC'//BEGYEAR
            DATE3='01JAN'//ENDYEAR
            DATE4=ENDDATE//ENDYEAR
C
             CALL DATJUL(DATE1,JUL1,ISTAT)
             CALL DATJUL(DATE2,JUL2,ISTAT)
             CALL DATJUL(DATE3,JULS,ISTAT)
             CALL DATJUL(DATE4,JULE,ISTAT)
C
         ACCT1=JUL2-JUL1+1
         ACCT2=JULE-JULS+1
         NODAYS=ACCT1+ACCT2
C
          DURDIFF=(JUL1-DURATION)+1
           ACCT3=(JUL2-DURDIFF)+1
            JULDAYS=ACCT3+ACCT2
C
          PATHNO=1
902       READ(2,13,END=800)STAGPATH(PATHNO)
           READ(2,14,END=800)ACREPATH(PATHNO)
            PATHNO=PATHNO+1
               GOTO 902
C
C
800   NVALS=NODAYS
C
      TAVG1=0.00
      TAVG2=0.00
      TAVG3=0.00
      TAVG4=0.00
      TAVG5=0.00
      WFTEST=0.00
C
      DO 21 K=1,PATHNO-1
C
        NUM1=INTGR(BEGYEAR,1,4,IERR)
         CALL DATJUL(DATE1,JUL1,ISTAT)
         DURDIFF=(JUL1-DURATION)+1
C
       CTIME='0100'
C
       DO 41 N=1,NOYEARS-1
C
C
       IF(OPTION.EQ.'2')THEN
          GOTO 701
       ENDIF
C
        WRITE(4,'('' STATION:'',A80)')ACREPATH(K)
        WRITE(4,'('' '')')
        WRITE(4,'('' DATE: '',A5,A4,''-'',A5,A4)')BEGDATE,BEGYEAR,
     .   ENDDATE,ENDYEAR
        WRITE(4,'('' DURATION & WATER DEPTH : '',I3,2X,F8.2)')DTE,
     .   WTRDEPTH
        WRITE(4,'('' '')')
        WRITE(4,'(2X,''TIME'',8X,''TOTAL'',6X,''WATERFOWL'',3X,
     .''WATERFOWL'',3X,''WATERFOWL'',4X,''WATERFOWL'')')
        WRITE(4,'(1X,''PERIOD'',7X,''ACRES'',7X,''ACRES'',7X,''FAILS'',
     .7X,''FAILS'',8X,''FAILS'')')
        WRITE(4,'(38X,''DEPTH'',6X,''DURATION'',3X,''DEPTH & DURATION''
     .)')
        WRITE(4,'('' '')')
C
701   ORCNT=0
      CNT=1
C
       JUL1=DURDIFF
       NVALS=JULDAYS
       CALL JULDAT(JUL1,104,CDATE,NDATE)
       CALL ZRRTS(IFLTAB,STAGPATH(K),CDATE,CTIME,NVALS,STAGES,CUNITS,
     .            CTYPE,IOFSET,ISTAT)
       IF(ISTAT.GE.4)THEN
       WRITE(4,'('' MISSING STAGE DATA IN DATABASE FOR YEAR '',A4)')
     .   CDATE(6:9)
         WRITE(4,'('' '')')
         NUM1=NUM1+1
          CALL INTGRC(NUM1,BYEAR,1,4)
          CDATE=BEGDATE//BYEAR
          CALL DATJUL(CDATE,JUL1,ISTAT)
           DURDIFF=(JUL1-DURATION)+1
           GOTO 41
       ENDIF
C
       JUL1=DURDIFF
       NVALS=JULDAYS
       CALL ZRRTS(IFFTAB,ACREPATH(K),CDATE,CTIME,NVALS,ACRES,CUNITS,
     .            CTYPE,IOFSET,ISTAT)
       IF(ISTAT.GE.4)THEN
       WRITE(4,'('' MISSING ACRES DATA IN DATABASE FOR YEAR '',A4)')
     .   CDATE(6:9)
         WRITE(4,'('' '')')
         NUM1=NUM1+1
          CALL INTGRC(NUM1,BYEAR,1,4)
          CDATE=BEGDATE//BYEAR
          CALL DATJUL(CDATE,JUL1,ISTAT)
          DURDIFF=(JUL1-DURATION)+1
           GOTO 41
       ENDIF
C
      DO 200 M=1,NVALS
         DUR(M)=0
         DE(M)=0
         DEPTH(M)=0
         IF(M.LT.DURATION)THEN
            GOTO 200
         ENDIF
         IF(ACRES(M).EQ.-901.00.OR.ACRES(M).EQ.-902.00)THEN
          GOTO 200
         ENDIF
        ORCNT=ORCNT+1
200   CONTINUE
C
      DURCNT=1
C
       DO 600 J=1,NVALS
       IF(J.LT.DURATION)THEN
         GOTO 600
       ENDIF
       IF(ACRES(J).EQ.-901.00.OR.ACRES(J).EQ.-902.00)THEN
         GOTO 600
       ENDIF
      YEARACRE=YEARACRE+ACRES(J)
600   CONTINUE
C
C
      XACRES(0)=0.0
      WFTEST=0.00
      WFACRE=0.00
      STAGES(0)=STAGES(1)-0.01
C
C
400    DO 500 NO=1,DURCNT
C
      IF(ACRES(NO).EQ.-901.00.OR.ACRES(NO).EQ.-902.00)THEN
         GOTO 500
      ENDIF
C
      IF(NO.EQ.DURCNT)THEN
         IF(ACRES(DURCNT-1).EQ.-901.00.OR.ACRES(DURCNT-1).EQ.-902.00)
     .THEN
         XACRES(DURCNT)=ACRES(DURCNT)
         DEPTH(DURCNT)=0.1
            GOTO 500
         ENDIF
      ENDIF
C
      XACRES(DURCNT)=ACRES(DURCNT)-ACRES(DURCNT-1)
      CDEPTH(DURCNT)=STAGES(DURCNT)-STAGES(DURCNT-1)
      DEPTH(DURCNT)=CDEPTH(DURCNT)/2
C
      IF(NO.NE.DURCNT) DEPTH(NO)=DEPTH(NO)+CDEPTH(DURCNT)
C
        DUR(NO)=DUR(NO)+1
         DUR(DURCNT)=1
C
      IF(STAGES(DURCNT).GT.STAGES(NO-1).AND.STAGES(DURCNT).LT.STAGES(NO)
     .) THEN
       SUBTRAC=ACRES(NO)-ACRES(DURCNT)
       STAGES(NO)=STAGES(DURCNT)
       ACRES(NO)=ACRES(NO)-SUBTRAC
       XACRES(NO)=XACRES(NO)-SUBTRAC
      ENDIF
C
      STAGES(0)=STAGES(1)
C
C
         IF(NO.EQ.DURCNT)GOTO 450

C
         IF(STAGES(DURCNT).LE.STAGES(NO))THEN
            STAGES(NO)=STAGES(DURCNT)
            DIFF=ACRES(NO)-ACRES(DURCNT)
            IF(DIFF.LT.0.00) DIFF=0.00
            XACRES(NO)=XACRES(NO)-DIFF
            ACRES(NO)=ACRES(DURCNT)
            ENDIF
          IF (XACRES(NO).LE.0.00)GOTO 500
C
C
450   CONTINUE
C
      FLAG='N'
      IF(NO.LT.DURATION)THEN
         ACRES(NO)=0.00
         FLAG='Y'
            GOTO 500
      ENDIF
C
      IF (XACRES(NO).LT.0.00)XACRES(NO)=0.00
C
            IF(DEPTH(NO).LE.WTRDEPTH)THEN
               DE(NO)=DE(NO)+1
               IF(DE(NO).LE.DTE)THEN
                WFTEST=WFTEST + XACRES(NO)
                 WFACRE=WFACRE + XACRES(NO)
                     GOTO 500
               ENDIF
             DURACRE=DURACRE + XACRES(NO)
                  GOTO 500
            ENDIF
           IF(DE(NO).LE.DTE)THEN
             DEEPACRE=DEEPACRE + XACRES(NO)
                  GOTO 500
           ENDIF
           IF(DE(NO).GT.DTE)THEN
             FACRES=FACRES + XACRES(NO)
           ENDIF
500   CONTINUE
C
        INTL=1440
        ISTIME=1440
        CALL JULDAT(JUL1,104,CDATE,NDATE)
        IDUM=INCTIM(INTL,0,(DURCNT-1),JUL1,ISTIME,JULE,IETIME)
        CALL JULDAT(JULE,104,CDATE,NDATE)
C
      IF(OPTION.EQ.'2')THEN
         GOTO 501
      ENDIF
C
      IF(FLAG.EQ.'Y')THEN
         GOTO 501
      ENDIF
C
      WRITE(4,'(A9,2X,F8.2,1X,F10.2,2X,F10.2,2X,F10.2,2X,F10.2)')
     . CDATE,ACRES(DURCNT),WFACRE,DEEPACRE,DURACRE,FACRES
C
501   IF(DURCNT.EQ.NVALS)THEN
C
        DATE1=BEGDATE//BEGYEAR
        CALL DATJUL(DATE1,JULS,ISTAT)
C
C
      AVG1=YEARACRE/ORCNT
      AVG2=WFACRE/ORCNT
      AVG3=DEEPACRE/ORCNT
      AVG4=DURACRE/ORCNT
      AVG5=FACRES/ORCNT
C
      DO 502 J=1,NVALS
       ACRES(J)=0.00
       XACRES(J)=0.00
502   CONTINUE
       WFACRE=0.00
       YEARACRE=0.00
       DEEPACRE=0.00
       DURACRE=0.00
       FACRES=0.00
C
      WRITE(4,'('' '')')
      WRITE(4,'(A5,A4,''-'',A5,A4,'' AVERAGES FOR - '',A50)')
     .BEGDATE,BEGYEAR,ENDDATE,ENDYEAR,ACREPATH(K)
      WRITE(4,'('' DURATION & WATER DEPTH : '',I3,2X,F8.2)')DTE,
     .   WTRDEPTH
        WRITE(4,'(2X,''    '',8X,''TOTAL'',6X,''WATERFOWL'',3X,
     .''WATERFOWL'',3X,''WATERFOWL'',4X,''WATERFOWL'')')
        WRITE(4,'(1X,''      '',7X,''ACRES'',7X,''ACRES'',7X,''FAILS'',
     .7X,''FAILS'',8X,''FAILS'')')
        WRITE(4,'(38X,''DEPTH'',6X,''DURATION'',3X,''DEPTH & DURATION''
     .)')
      WRITE(4,'(13X,F8.2,2X,F10.2,2X,F10.2,2X,F10.2,2X,F10.2)')AVG1,
     .   AVG2,AVG3,AVG4,AVG5
      WRITE(4,'('' '')')
      WRITE(4,'('' '')')
C
      TAVG1=TAVG1+AVG1
      TAVG2=TAVG2+AVG2
      TAVG3=TAVG3+AVG3
      TAVG4=TAVG4+AVG4
      TAVG5=TAVG5+AVG5
C
           GOTO 404
      ENDIF
C
      WFTEST=0.00
      DURCNT=DURCNT+1
C
      GOTO 400
C
404   NUM1=NUM1+1
      CALL INTGRC(NUM1,BYEAR,1,4)
      CDATE=BEGDATE//BYEAR
      CALL DATJUL(CDATE,JUL1,ISTAT)
      DURDIFF=(JUL1-DURATION)+1
C
41    CONTINUE
C
21    CONTINUE
C
      TAVG1=TAVG1/NOYEARS
      TAVG2=TAVG2/NOYEARS
      TAVG3=TAVG3/NOYEARS
      TAVG4=TAVG4/NOYEARS
      TAVG5=TAVG5/NOYEARS
C
      DO 650 J=1,PATHNO-1
        WRITE(4,'('' STATIONS DETERMINED : '',A50)')ACREPATH(J)
650   CONTINUE
C
      WRITE(4,'('' '')')
      WRITE(4,'('' PERIOD OF RECORD AVERAGES FOR THE : '')')
      WRITE(4,'('' MONTHS : '',A5,'' - '',A5,'' DURATION : '',I3,
     . '' WATER DEPTH : '',F8.2)')BEGDATE,ENDDATE,DTE,WTRDEPTH
      WRITE(4,'('' YEARS : '',A4,'' - '',A4)')BEGYEAR,ENDYEAR
      WRITE(4,'('' '')')
        WRITE(4,'(2X,''    '',8X,''TOTAL'',6X,''WATERFOWL'',3X,
     .''WATERFOWL'',3X,''WATERFOWL'',4X,''WATERFOWL'')')
        WRITE(4,'(1X,''      '',7X,''ACRES'',7X,''ACRES'',7X,''FAILS'',
     .7X,''FAILS'',8X,''FAILS'')')
        WRITE(4,'(38X,''DEPTH'',6X,''DURATION'',3X,''DEPTH & DURATION''
     .)')
      WRITE(4,'(13X,F8.2,2X,F10,2X,F10.2,2X,F10.2,2X,F10.2)')TAVG1,
     .      TAVG2,TAVG3,TAVG4,TAVG5
C
10    FORMAT(A5,1X,A5)
11    FORMAT(I3,1X,F4.1,1X,I3)
12    FORMAT(A4,1X,A4)
13    FORMAT(A80)
14    FORMAT(A80)
C
900   STOP
      END
